@model EhjozProject.Web.ViewModels.Booking.BookingViewModel
@{
    ViewData["Title"] = "Book Stadium";
    var stadium = ViewBag.Stadium as EhjozProject.Domain.Models.Stadium.Stadium;
    var timeSlots = ViewBag.TimeSlots as List<EhjozProject.Domain.Models.Stadium.TimeSlot>;
    var selectedDate = ViewBag.SelectedDate as DateTime?;
}

<div class="booking-page">
    <!-- Back Button -->
    <div class="back-nav">
        <a asp-controller="Stadium" asp-action="Details" asp-route-id="@stadium?.Id" class="btn-back">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Back to Stadium
        </a>
    </div>

    <div class="row">
        <!-- Time Slots Selection -->
        <div class="col-lg-8">
            <div class="booking-card">
                <h2>Select Time Slot</h2>
                <p class="text-muted">Choose your preferred time slot for @stadium?.Name</p>

                <!-- Date Selection -->
                <div class="date-selection">
                    <form method="get" class="date-form">
                        <input type="hidden" name="stadiumId" value="@stadium?.Id" />
                        <div class="row align-items-end">
                            <div class="col-md-6">
                                <label class="form-label">Select Date</label>
                                <input type="date" name="date" class="form-control"
                                       value="@(selectedDate?.ToString("yyyy-MM-dd") ?? DateTime.Now.ToString("yyyy-MM-dd"))"
                                       min="@DateTime.Now.ToString("yyyy-MM-dd")"
                                       onchange="this.form.submit()" />
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Time Slots Grid -->
                <div class="time-slots-section">
                    <h4>Available Time Slots for @(selectedDate?.ToString("dddd, MMMM dd, yyyy") ?? DateTime.Now.ToString("dddd, MMMM dd, yyyy"))</h4>

                    @if (timeSlots != null && timeSlots.Any())
                    {
                        <form asp-controller="Booking" asp-action="Confirm" method="post" id="bookingForm">
                            <input type="hidden" name="StadiumId" value="@stadium?.Id" />
                            <input type="hidden" name="BookingDate" value="@(selectedDate?.ToString("yyyy-MM-dd") ?? DateTime.Now.ToString("yyyy-MM-dd"))" />

                            <div class="time-slots-grid">
                                @foreach (var slot in timeSlots)
                                {
                                    <div class="time-slot-item @(slot.IsAvailable ? "available" : "unavailable")">
                                        <input type="radio" name="TimeSlotId" value="@slot.Id"
                                               id="slot_@slot.Id"
                                               @(slot.IsAvailable ? "" : "disabled")
                                               class="time-slot-radio" required />
                                        <label for="slot_@slot.Id" class="time-slot-label">
                                            <span class="time">@slot.StartTime.ToString("hh:mm tt") - @slot.EndTime.ToString("hh:mm tt")</span>
                                            @if (slot.IsAvailable)
                                            {
                                                <span class="status available">Available</span>
                                            }
                                            else
                                            {
                                                <span class="status booked">Booked</span>
                                            }
                                        </label>
                                    </div>
                                }
                            </div>

                            <div class="booking-notes">
                                <label class="form-label">Notes (Optional)</label>
                                <textarea name="Notes" class="form-control" rows="3" placeholder="Any special requests or notes..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-success btn-continue">
                                Continue to Confirmation
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 12h14M12 5l7 7-7 7" />
                                </svg>
                            </button>
                        </form>
                    }
                    else
                    {
                        <div class="no-slots">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <h4>No Time Slots Available</h4>
                            <p>There are no available time slots for this date. Please select another date.</p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Booking Summary -->
        <div class="col-lg-4">
            <div class="summary-card">
                <h3>Booking Summary</h3>

                <div class="stadium-mini">
                    <img src="@(stadium?.ImageUrl ?? "https://images.unsplash.com/photo-1574629810360-7efbbe195018?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80")" alt="@stadium?.Name">
                    <div>
                        <strong>@stadium?.Name</strong>
                        <span>@stadium?.City</span>
                    </div>
                </div>

                <div class="summary-details">
                    <div class="summary-row">
                        <span>Date</span>
                        <span id="summaryDate">@(selectedDate?.ToString("MMM dd, yyyy") ?? DateTime.Now.ToString("MMM dd, yyyy"))</span>
                    </div>
                    <div class="summary-row">
                        <span>Time</span>
                        <span id="summaryTime">Select a slot</span>
                    </div>
                    <div class="summary-row">
                        <span>Duration</span>
                        <span>1 Hour</span>
                    </div>
                    <hr>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span>$@stadium?.PricePerHour</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .booking-page {
            padding: 1rem 0 3rem;
        }

        .back-nav {
            margin-bottom: 1.5rem;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #666;
            text-decoration: none;
            font-weight: 500;
        }

            .btn-back:hover {
                color: #1a5d2b;
            }

        .booking-card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

            .booking-card h2 {
                font-size: 1.5rem;
                font-weight: 700;
                color: #1a5d2b;
                margin-bottom: 0.5rem;
            }

        .date-selection {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .time-slots-section {
            margin-top: 2rem;
        }

            .time-slots-section h4 {
                font-size: 1rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 1rem;
            }

        .time-slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .time-slot-item {
            position: relative;
        }

        .time-slot-radio {
            position: absolute;
            opacity: 0;
        }

        .time-slot-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-slot-item.available .time-slot-label:hover {
            border-color: #1a5d2b;
            background: #f8fff8;
        }

        .time-slot-radio:checked + .time-slot-label {
            border-color: #1a5d2b;
            background: #e8f5e9;
        }

        .time-slot-item.unavailable .time-slot-label {
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .time-slot-label .time {
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .time-slot-label .status {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
        }

        .status.available {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status.booked {
            background: #ffebee;
            color: #c62828;
        }

        .booking-notes {
            margin-bottom: 1.5rem;
        }

        .btn-continue {
            width: 100%;
            padding: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .no-slots {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

            .no-slots svg {
                color: #ccc;
                margin-bottom: 1rem;
            }

        /* Summary Card */
        .summary-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            position: sticky;
            top: 20px;
        }

            .summary-card h3 {
                font-size: 1.1rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 1.5rem;
            }

        .stadium-mini {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
            margin-bottom: 1rem;
        }

            .stadium-mini img {
                width: 60px;
                height: 60px;
                border-radius: 8px;
                object-fit: cover;
            }

            .stadium-mini strong {
                display: block;
                color: #333;
            }

            .stadium-mini span {
                color: #666;
                font-size: 0.9rem;
            }

        .summary-details {
            padding: 1rem 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: #666;
        }

            .summary-row.total {
                font-weight: 700;
                font-size: 1.1rem;
                color: #1a5d2b;
            }
    </style>
}

@section Scripts {
    <script>
        document.querySelectorAll('.time-slot-radio').forEach(radio => {
            radio.addEventListener('change', function() {
                const label = this.nextElementSibling;
                const time = label.querySelector('.time').textContent;
                document.getElementById('summaryTime').textContent = time;
            });
        });
    </script>
}
